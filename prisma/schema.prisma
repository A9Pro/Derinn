datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// Admin users only - for dashboard access
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  password  String
  role      String   @default("admin") // Only admins need accounts
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id          String    @id @default(cuid())
  name        String    @unique
  description String?
  slug        String    @unique // URL-friendly version
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[]
}

model Product {
  id            String      @id @default(cuid())
  name          String
  description   String?
  productNumber String      @unique // Item/Product number
  price         Float
  stock         Int         @default(0)
  imageUrl      String      // Main product image
  images        String?     // JSON array of additional images
  category      Category    @relation(fields: [categoryId], references: [id])
  categoryId    String
  isActive      Boolean     @default(true) // Show/hide product
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  orderItems    OrderItem[]
  cartItems     CartItem[]
}

// Guest saved carts with ED-#### codes
model SavedCart {
  id          String     @id @default(cuid())
  cartCode    String     @unique // ED-1234 format
  email       String?    // Optional email for notifications
  items       CartItem[]
  totalAmount Float      @default(0)
  expiresAt   DateTime   // Auto-delete after 30 days
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model CartItem {
  id          String     @id @default(cuid())
  quantity    Int        @default(1)
  product     Product    @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId   String
  savedCart   SavedCart  @relation(fields: [savedCartId], references: [id], onDelete: Cascade)
  savedCartId String
  priceAtAdd  Float      // Price when added (in case it changes)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

// Guest orders - no user login required
model Order {
  id            String      @id @default(cuid())
  orderNumber   String      @unique // ORD-#### format
  cartCode      String?     // Reference to ED-#### if from saved cart
  
  // Customer info collected at checkout
  customerName  String
  customerEmail String
  customerPhone String?
  
  // Shipping address
  shippingStreet  String
  shippingCity    String
  shippingState   String
  shippingZip     String
  shippingCountry String @default("Nigeria")
  
  status        String      @default("pending") // pending, processing, shipped, delivered, cancelled
  total         Float
  items         OrderItem[]
  
  // Payment info
  paymentMethod String?     // card, bank_transfer, cash_on_delivery
  paymentStatus String      @default("unpaid") // unpaid, paid, refunded
  
  notes         String?     // Special delivery instructions
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model OrderItem {
  id        String   @id @default(cuid())
  quantity  Int
  price     Float    // Price at time of order
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderId   String
  product   Product  @relation(fields: [productId], references: [id])
  productId String
  createdAt DateTime @default(now())
}